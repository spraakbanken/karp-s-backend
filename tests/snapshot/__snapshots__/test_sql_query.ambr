# serializer version: 1
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-COLLECTION,WORD[cCOLLECTION_COLLECTION_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-COLLECTION[cCOLLECTION_COLLECTION_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-SCALAR,COLLECTION,WORD[cCOLLECTION_COLLECTION_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-SCALAR,COLLECTION[cCOLLECTION_COLLECTION_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-SCALAR,WORD[cCOLLECTION_COLLECTION_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-SCALAR[cCOLLECTION_COLLECTION_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-WORD[cCOLLECTION_COLLECTION_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-COLLECTION_query-[cCOLLECTION_COLLECTION_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id UNION ALL SELECT `col1`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id) as innerq GROUP BY `col1`, `resource_id`, `col1`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-COLLECTION,WORD[cCOLLECTION_None_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-COLLECTION[cCOLLECTION_None_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-SCALAR,COLLECTION,WORD[cCOLLECTION_None_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-SCALAR,COLLECTION[cCOLLECTION_None_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-SCALAR,WORD[cCOLLECTION_None_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-SCALAR[cCOLLECTION_None_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-WORD[cCOLLECTION_None_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-None_query-[cCOLLECTION_None_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id` FROM (SELECT `col1`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id) as innerq) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-COLLECTION,WORD[cCOLLECTION_SCALAR_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-COLLECTION[cCOLLECTION_SCALAR_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-SCALAR,COLLECTION,WORD[cCOLLECTION_SCALAR_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-SCALAR,COLLECTION[cCOLLECTION_SCALAR_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-SCALAR,WORD[cCOLLECTION_SCALAR_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-SCALAR[cCOLLECTION_SCALAR_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-WORD[cCOLLECTION_SCALAR_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-SCALAR_query-[cCOLLECTION_SCALAR_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `data3` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id) as innerq GROUP BY `col1`, `resource_id`, `data3`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-COLLECTION,WORD[cCOLLECTION_WORD_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-COLLECTION[cCOLLECTION_WORD_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-SCALAR,COLLECTION,WORD[cCOLLECTION_WORD_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-SCALAR,COLLECTION[cCOLLECTION_WORD_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-SCALAR,WORD[cCOLLECTION_WORD_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-SCALAR[cCOLLECTION_WORD_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-WORD[cCOLLECTION_WORD_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-COLLECTION_columns-WORD_query-[cCOLLECTION_WORD_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `col1`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `col1`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `col1`, `resource_id`, `entry_word` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id) as innerq GROUP BY `col1`, `resource_id`, `entry_word`) as innerq GROUP BY `col1`, `resource_id`) as innerq GROUP BY `col1` ORDER BY `col1`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-COLLECTION,WORD[cSCALAR_COLLECTION_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-COLLECTION[cSCALAR_COLLECTION_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-SCALAR,COLLECTION,WORD[cSCALAR_COLLECTION_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-SCALAR,COLLECTION[cSCALAR_COLLECTION_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-SCALAR,WORD[cSCALAR_COLLECTION_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-SCALAR[cSCALAR_COLLECTION_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-WORD[cSCALAR_COLLECTION_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-COLLECTION_query-[cSCALAR_COLLECTION_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `col1` FROM (SELECT `col1`, `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id UNION ALL SELECT `col1`, `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id) as innerq GROUP BY `data3`, `resource_id`, `col1`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-COLLECTION,WORD[cSCALAR_None_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-COLLECTION[cSCALAR_None_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-SCALAR,COLLECTION,WORD[cSCALAR_None_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-SCALAR,COLLECTION[cSCALAR_None_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-SCALAR,WORD[cSCALAR_None_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-SCALAR[cSCALAR_None_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-WORD[cSCALAR_None_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-None_query-[cSCALAR_None_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id) as innerq) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-COLLECTION,WORD[cSCALAR_SCALAR_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-COLLECTION[cSCALAR_SCALAR_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-SCALAR,COLLECTION,WORD[cSCALAR_SCALAR_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-SCALAR,COLLECTION[cSCALAR_SCALAR_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-SCALAR,WORD[cSCALAR_SCALAR_['SCALAR', 'WORD']]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1` WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-SCALAR[cSCALAR_SCALAR_['SCALAR']]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` WHERE `data3` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1` WHERE `data3` = '1') as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-WORD[cSCALAR_SCALAR_['WORD']]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` WHERE `data1` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1` WHERE `data2` = '1') as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-SCALAR_query-[cSCALAR_SCALAR_[]]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id` FROM (SELECT `data3`, 'r0' AS resource_id FROM `r0` UNION ALL SELECT `data3`, 'r1' AS resource_id FROM `r1`) as innerq GROUP BY `data3`, `resource_id`, `data3`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-COLLECTION,WORD[cSCALAR_WORD_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-COLLECTION[cSCALAR_WORD_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-SCALAR,COLLECTION,WORD[cSCALAR_WORD_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-SCALAR,COLLECTION[cSCALAR_WORD_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-SCALAR,WORD[cSCALAR_WORD_['SCALAR', 'WORD']]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-SCALAR[cSCALAR_WORD_['SCALAR']]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data3` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data3` = '1') as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-WORD[cSCALAR_WORD_['WORD']]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data1` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data2` = '1') as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-SCALAR_columns-WORD_query-[cSCALAR_WORD_[]]
  tuple(
    "SELECT SUM(count) AS count, `data3`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `data3`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `data3`, `resource_id`, `entry_word` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1`) as innerq GROUP BY `data3`, `resource_id`, `entry_word`) as innerq GROUP BY `data3`, `resource_id`) as innerq GROUP BY `data3` ORDER BY `data3`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-COLLECTION,WORD[cWORD_COLLECTION_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-COLLECTION[cWORD_COLLECTION_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-SCALAR,COLLECTION,WORD[cWORD_COLLECTION_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-SCALAR,COLLECTION[cWORD_COLLECTION_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-SCALAR,WORD[cWORD_COLLECTION_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-SCALAR[cWORD_COLLECTION_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-WORD[cWORD_COLLECTION_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-COLLECTION_query-[cWORD_COLLECTION_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'col1', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('col1', `col1`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `col1` FROM (SELECT `col1`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id UNION ALL SELECT `col1`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id) as innerq GROUP BY `entry_word`, `resource_id`, `col1`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-COLLECTION,WORD[cWORD_None_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-COLLECTION[cWORD_None_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-SCALAR,COLLECTION,WORD[cWORD_None_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-SCALAR,COLLECTION[cWORD_None_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-SCALAR,WORD[cWORD_None_['SCALAR', 'WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1') as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-SCALAR[cWORD_None_['SCALAR']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data3` = '1') as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-WORD[cWORD_None_['WORD']]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id WHERE `data2` = '1') as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-None_query-[cWORD_None_[]]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r1__col2` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT `entry_word`, `resource_id` FROM (SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id UNION ALL SELECT `data2`, `data3`, `col1`, `col2` FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r1.__id) as innerq) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-COLLECTION,WORD[cWORD_SCALAR_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-COLLECTION[cWORD_SCALAR_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-SCALAR,COLLECTION,WORD[cWORD_SCALAR_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-SCALAR,COLLECTION[cWORD_SCALAR_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-SCALAR,WORD[cWORD_SCALAR_['SCALAR', 'WORD']]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-SCALAR[cWORD_SCALAR_['SCALAR']]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data3` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data3` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-WORD[cWORD_SCALAR_['WORD']]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data1` = '1' UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data2` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-SCALAR_query-[cWORD_SCALAR_[]]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'data3', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('data3', `data3`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id`, `data3` FROM (SELECT `data3`, 'r0' AS resource_id, `data1` AS entry_word FROM `r0` UNION ALL SELECT `data3`, 'r1' AS resource_id, `data2` AS entry_word FROM `r1`) as innerq GROUP BY `entry_word`, `resource_id`, `data3`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-COLLECTION,WORD[cWORD_WORD_['COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-COLLECTION[cWORD_WORD_['COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-SCALAR,COLLECTION,WORD[cWORD_WORD_['SCALAR', 'COLLECTION', 'WORD']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data2` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-SCALAR,COLLECTION[cWORD_WORD_['SCALAR', 'COLLECTION']]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col1__where AS (SELECT `__parent_id` FROM `r1__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r1__col1` GROUP BY `__parent_id`) SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id) UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r1.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r1.__id = __parent_id)) as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-SCALAR,WORD[cWORD_WORD_['SCALAR', 'WORD']]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data1` = '1' and `data3` = '1' UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data2` = '1' and `data3` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-SCALAR[cWORD_WORD_['SCALAR']]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data3` = '1' UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data3` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-WORD[cWORD_WORD_['WORD']]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` WHERE `data1` = '1' UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1` WHERE `data2` = '1') as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_count_compile-WORD_columns-WORD_query-[cWORD_WORD_[]]
  tuple(
    "SELECT SUM(count) AS count, `entry_word`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('resource_id', `resource_id`,'count', `count`,'entry_word', `entry_data`)), ']') AS `entry_data` FROM (SELECT SUM(count) AS count, `entry_word`, `resource_id`, CONCAT('[', GROUP_CONCAT(JSON_OBJECT('entry_word', `entry_word`,'count', `count`)), ']') AS `entry_data` FROM (SELECT COUNT(*) AS count, `entry_word`, `resource_id` FROM (SELECT 'r0' AS resource_id, `data1` AS entry_word FROM `r0` UNION ALL SELECT 'r1' AS resource_id, `data2` AS entry_word FROM `r1`) as innerq GROUP BY `entry_word`, `resource_id`, `entry_word`) as innerq GROUP BY `entry_word`, `resource_id`) as innerq GROUP BY `entry_word` ORDER BY `entry_word`",
    None,
  )
# ---
# name: test_search_COLLECTION,WORD[sCOLLECTION,WORD]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id)",
    None,
  )
# ---
# name: test_search_COLLECTION[sCOLLECTION]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id)",
    None,
  )
# ---
# name: test_search_SCALAR,COLLECTION,WORD[sSCALAR,COLLECTION,WORD]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id)",
    None,
  )
# ---
# name: test_search_SCALAR,COLLECTION[sSCALAR,COLLECTION]
  tuple(
    "WITH col1__where AS (SELECT `__parent_id` FROM `r0__col1` WHERE `value` = '1' GROUP BY `__parent_id`), col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1' and EXISTS (SELECT 1 FROM `col1__where` WHERE r0.__id = __parent_id)",
    None,
  )
# ---
# name: test_search_SCALAR,WORD[sSCALAR,WORD]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1' and `data3` = '1'",
    None,
  )
# ---
# name: test_search_SCALAR[sSCALAR]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data3` = '1'",
    None,
  )
# ---
# name: test_search_WORD[sWORD]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id WHERE `data1` = '1'",
    None,
  )
# ---
# name: test_search_[s]
  tuple(
    "WITH col1__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col1 FROM `r0__col1` GROUP BY `__parent_id`), col2__data AS (SELECT `__parent_id`, GROUP_CONCAT(value SEPARATOR '\x1f') AS col2 FROM `r0__col2` GROUP BY `__parent_id`) SELECT `data1`, `data3`, `col1`, `col2` FROM `r0` LEFT JOIN `col1__data` ON `col1__data`.__parent_id = r0.__id LEFT JOIN `col2__data` ON `col2__data`.__parent_id = r0.__id",
    None,
  )
# ---
